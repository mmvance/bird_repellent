/**************************************/
项目名称:超声波驱鸟系统
版本:v0.10
时间:20230617
/**************************************/
本程序使用函数封装形式,有两个功能。
分别为语音芯片:WT588,超声波模块:PWM控制。
语音播报:函数在WT588.c中。
PWM控制为Hal库PWM控制函数。

以下为语音模块介绍:
/*-------------------------------------
模块名称:Line_2A_WT588F(UC8 DDATA)
功能:实现二线串口通信函数
入参:DDATA 为发送数据
出参:
CLK_2A 时钟线
P_DATA_2A 数据线
-------------------------------------*/
发送数据有以下命令码:
E0(FFE0)    音量最小;
EF(FFEF)    音量最大;
F2          循环播放当前语音;
F3          连码播放;
FE          停止播放当前语音.

EG:发送第一段语音的程序示例:
Line_2A_WT588F(0xF3);
delay_ms(2); //延时2ms
Line_2A_WT588F(0x01);//第一段语音
delay_ms(5); //延时5ms
注意延迟需要分别为2ms和5ms。
---------------------------------------


/*-------------------------------------
PWM控制为Hal库PWM控制函数
以下为超声波PWM控制函数介绍:
void ultrasonic_duty(uint16_t duty)//修改占空比比较值,实际占空比为duty/fre;
{
  __HAL_TIM_SetCompare(&htim1,TIM_CHANNEL_1,duty);
}

在程序中,预先设定的PSC值为72
可以通过改变psc和arr的值以改变频率,频率=(72M/psc)/fre

void ultrasonic_fre(uint16_t fre)//改变arr以改变频率
{
  __HAL_TIM_SetCompare(&htim1,TIM_CHANNEL_1,fre-1);
}
---------------------------------------